/*
 * This file was generated by `pastoria`.
 * @generated-checksum ddea051cf0210af92e92cd922cb557451deee4ec91f97922fb34014b356260a4
 * Do not modify this file directly. Instead, edit the template at js_resource.ts.
 */

import type { JSResourceReference } from 'react-relay/hooks';

type ResourceConf = typeof RESOURCE_CONF;
const RESOURCE_CONF = {
  '/': {
    src: 'pastoria/page.tsx',
    loader: () => import('#pastoria/page').then((m) => m.default),
  },
  '/about': {
    src: 'pastoria/about/page.tsx',
    loader: () => import('#pastoria/about/page').then((m) => m.default),
  },
  '/privacy': {
    src: 'pastoria/privacy/page.tsx',
    loader: () => import('#pastoria/privacy/page').then((m) => m.default),
  },
  '/profile': {
    src: 'pastoria/profile/page.tsx',
    loader: () => import('#pastoria/profile/page').then((m) => m.default),
  },
  '/staples': {
    src: 'pastoria/staples/page.tsx',
    loader: () => import('#pastoria/staples/page').then((m) => m.default),
  },
  '/tournaments': {
    src: 'pastoria/tournaments/page.tsx',
    loader: () => import('#pastoria/tournaments/page').then((m) => m.default),
  },
  '/commander/[commander]#entries': {
    src: 'pastoria/commander/[commander]/entries.tsx',
    loader: () =>
      import('#pastoria/commander/[commander]/entries').then((m) => m.default),
  },
  '/commander/[commander]': {
    src: 'pastoria/commander/[commander]/page.tsx',
    loader: () =>
      import('#pastoria/commander/[commander]/page').then((m) => m.default),
  },
  '/commander/[commander]#staple_details': {
    src: 'pastoria/commander/[commander]/staple_details.tsx',
    loader: () =>
      import('#pastoria/commander/[commander]/staple_details').then(
        (m) => m.default,
      ),
  },
  '/commander/[commander]#staples': {
    src: 'pastoria/commander/[commander]/staples.tsx',
    loader: () =>
      import('#pastoria/commander/[commander]/staples').then((m) => m.default),
  },
  '/reports/country_winrates': {
    src: 'pastoria/reports/country_winrates/page.tsx',
    loader: () =>
      import('#pastoria/reports/country_winrates/page').then((m) => m.default),
  },
  '/tournament/[tid]#breakdown': {
    src: 'pastoria/tournament/[tid]/breakdown.tsx',
    loader: () =>
      import('#pastoria/tournament/[tid]/breakdown').then((m) => m.default),
  },
  '/tournament/[tid]#commander_breakdown': {
    src: 'pastoria/tournament/[tid]/commander_breakdown.tsx',
    loader: () =>
      import('#pastoria/tournament/[tid]/commander_breakdown').then(
        (m) => m.default,
      ),
  },
  '/tournament/[tid]': {
    src: 'pastoria/tournament/[tid]/page.tsx',
    loader: () =>
      import('#pastoria/tournament/[tid]/page').then((m) => m.default),
  },
  '/tournament/[tid]#standings': {
    src: 'pastoria/tournament/[tid]/standings.tsx',
    loader: () =>
      import('#pastoria/tournament/[tid]/standings').then((m) => m.default),
  },
} as const;

type ModuleId = keyof ResourceConf;
export type ModuleType<M extends ModuleId> = Awaited<
  ReturnType<ResourceConf[M]['loader']>
>;

export class JSResource<M extends ModuleId>
  implements JSResourceReference<ModuleType<M>>
{
  static srcOfModuleId(id: string): string | null {
    return RESOURCE_CONF[id as ModuleId].src;
  }

  private static readonly resourceCache = new Map<ModuleId, JSResource<any>>();
  static fromModuleId<M extends ModuleId>(moduleId: M): JSResource<M> {
    if (JSResource.resourceCache.has(moduleId)) {
      return JSResource.resourceCache.get(moduleId)!;
    }

    const resource = new JSResource(moduleId);
    JSResource.resourceCache.set(moduleId, resource);
    return resource;
  }

  private constructor(private readonly moduleId: M) {}
  private modulePromiseCache: Promise<ModuleType<M>> | null = null;
  private moduleCache: ModuleType<M> | null = null;

  getModuleId(): string {
    return this.moduleId;
  }

  getModuleIfRequired(): ModuleType<M> | null {
    return this.moduleCache;
  }

  async load(): Promise<ModuleType<M>> {
    if (this.modulePromiseCache == null) {
      this.modulePromiseCache = RESOURCE_CONF[this.moduleId]
        .loader()
        .then((m) => {
          this.moduleCache = m as ModuleType<M>;
          return this.moduleCache;
        });
    }

    return await this.modulePromiseCache;
  }
}
